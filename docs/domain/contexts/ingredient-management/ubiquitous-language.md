# 食材管理コンテキスト - ユビキタス言語集

## 概要

このドキュメントは、食材管理コンテキスト固有のユビキタス言語を定義します。
これらの用語は、このコンテキスト内でドメインエキスパートと開発チームが共通で使用する言語です。

## コンテキスト固有の用語

### 認証・所有権関連

| 用語       | 英語   | 定義                                         | 使用例                               |
| ---------- | ------ | -------------------------------------------- | ------------------------------------ |
| ユーザーID | UserId | ユーザー認証コンテキストから提供される識別子 | 「食材は必ずUserIdに紐づく」         |
| 所有者     | Owner  | 食材を登録・管理するユーザー                 | 「食材の所有者のみ操作可能」         |
| アクセス権 | Access | ユーザーが自分の食材のみ操作できる権限       | 「他ユーザーの食材へのアクセス拒否」 |

### 食材関連

| 用語           | 英語                  | 定義                                                       | 使用例                         |
| -------------- | --------------------- | ---------------------------------------------------------- | ------------------------------ |
| 食材           | Ingredient            | システムに登録された食材の基本情報                         | 「牛乳は1つの食材として登録」  |
| 食材在庫情報   | IngredientStock       | 食材の在庫情報を表す値オブジェクト（数量はnumber型で保持） | 「IngredientStockで在庫管理」  |
| 期限情報       | ExpiryInfo            | 賞味期限と消費期限を管理する値オブジェクト                 | 「ExpiryInfoで期限を一体管理」 |
| 登録食材       | Registered Ingredient | システムに登録済みの食材                                   | 「登録食材は全部で50件」       |
| アクティブ食材 | Active Ingredient     | 在庫があり、期限切れでない食材                             | 「アクティブ食材のみ表示」     |
| 食材メモ       | Ingredient Memo       | 食材に関する補足情報                                       | 「特売品で購入」などのメモ     |

### 在庫管理

| 用語     | 英語             | 定義                             | ビジネスルール            |
| -------- | ---------------- | -------------------------------- | ------------------------- |
| 在庫量   | Stock Quantity   | 現在保有している食材の数量       | 0以上の値                 |
| 在庫閾値 | Stock Threshold  | 在庫不足と判定する基準値         | 食材ごとに設定可能        |
| 消費     | Consume          | 食材を使用して在庫を減らすこと   | 在庫量を超えて消費不可    |
| 補充     | Replenish        | 食材を購入して在庫を増やすこと   | -                         |
| 在庫調整 | Stock Adjustment | 棚卸しなどで在庫量を修正すること | 理由の記録が必要          |
| 完全消費 | Fully Consumed   | 在庫量が0になること              | 削除候補として表示        |
| 在庫切れ | Stock Depleted   | 在庫が0になった状態              | StockDepletedイベント発生 |

### 期限管理

| 用語     | 英語            | 定義                         | 閾値    |
| -------- | --------------- | ---------------------------- | ------- |
| 新鮮     | Fresh           | 期限まで十分な余裕がある状態 | 8日以上 |
| 期限接近 | Near Expiry     | 期限が近づいている状態       | 7日以内 |
| 期限間近 | Expiring Soon   | 優先的に消費すべき状態       | 3日以内 |
| 期限切迫 | Critical Expiry | 緊急に消費が必要な状態       | 1日以内 |
| 期限切れ | Expired         | 賞味/消費期限を過ぎた状態    | 0日以下 |

### 保存管理

| 用語         | 英語                     | 定義             | 温度帯                     |
| ------------ | ------------------------ | ---------------- | -------------------------- |
| 冷蔵保存     | Refrigerated Storage     | 冷蔵庫での保存   | 0-10℃                      |
| 冷凍保存     | Frozen Storage           | 冷凍庫での保存   | -18℃以下                   |
| 常温保存     | Room Temperature Storage | 常温での保存     | 15-25℃                     |
| 保存場所詳細 | Storage Location Detail  | 具体的な保存位置 | 「野菜室」「ドアポケット」 |

### 分類体系

| 用語               | 英語             | 定義               | 例                     |
| ------------------ | ---------------- | ------------------ | ---------------------- |
| 主カテゴリー       | Primary Category | 食材の大分類       | 「野菜」「肉・魚」     |
| 食材グループ       | Ingredient Group | 類似食材のまとまり | 「葉物野菜」「根菜」   |
| カスタムカテゴリー | Custom Category  | ユーザー定義の分類 | 「お弁当用」「朝食用」 |

## コンテキスト固有のアクション

### 在庫操作

| アクション | 英語                 | 説明               | 事前条件        | 事後条件       |
| ---------- | -------------------- | ------------------ | --------------- | -------------- |
| 初期登録   | Initial Registration | 新規食材の登録     | -               | 在庫量 > 0     |
| 追加購入   | Additional Purchase  | 既存食材の買い足し | 食材が登録済み  | 在庫量増加     |
| 部分消費   | Partial Consumption  | 一部を使用         | 在庫量 > 消費量 | 在庫量減少     |
| 全量消費   | Complete Consumption | すべて使い切る     | 在庫量 ≥ 消費量 | 在庫量 = 0     |
| 廃棄登録   | Waste Registration   | 期限切れ等での廃棄 | -               | 廃棄履歴に記録 |

### 期限操作

| アクション | 英語           | 説明           | 使用場面           |
| ---------- | -------------- | -------------- | ------------------ |
| 期限延長   | Extend Expiry  | 期限の再設定   | 冷凍保存への変更時 |
| 期限短縮   | Shorten Expiry | 期限を早める   | 開封後             |
| 期限削除   | Remove Expiry  | 期限情報の削除 | 期限のない食材     |

## ビジネスルール用語

### 在庫管理ルール

| ルール名           | 説明                            | 適用条件           |
| ------------------ | ------------------------------- | ------------------ |
| 最小在庫ルール     | 在庫が閾値を下回ったら警告      | カテゴリー別に設定 |
| 同一食材統合ルール | 同じ食材・期限・場所は1エントリ | 新規登録時         |
| ゼロ在庫保持ルール | 在庫0でも履歴として保持         | 消費パターン分析用 |

### 期限管理ルール

| ルール名       | 説明                             | 通知タイミング      |
| -------------- | -------------------------------- | ------------------- |
| 段階的期限通知 | 期限に応じて通知頻度を変更       | 7日前、3日前、1日前 |
| 期限なし許可   | 調味料等は期限なしOK             | -                   |
| 消費期限優先   | 消費期限がある場合はそちらを優先 | -                   |

## ドメインイベント

### 食材ライフサイクルイベント

| イベント名   | 英語              | 発生タイミング | ペイロード                         |
| ------------ | ----------------- | -------------- | ---------------------------------- |
| 食材登録済み | IngredientCreated | 食材登録時     | 食材ID、ユーザーID、名前、初期数量 |
| 食材更新済み | IngredientUpdated | 食材情報更新時 | 食材ID、ユーザーID、変更内容       |
| 食材削除済み | IngredientDeleted | 食材削除時     | 食材ID、ユーザーID                 |

### 在庫変動イベント

| イベント名   | 英語             | 発生タイミング | ペイロード                       |
| ------------ | ---------------- | -------------- | -------------------------------- |
| 在庫消費済み | StockConsumed    | 在庫消費時     | 食材ID、ユーザーID、消費数量     |
| 在庫補充済み | StockReplenished | 在庫補充時     | 食材ID、ユーザーID、補充数量     |
| 在庫枯渇     | StockDepleted    | 在庫切れ時     | 食材ID、ユーザーID、食材名       |
| 在庫調整済み | StockAdjusted    | 在庫調整時     | 食材ID、ユーザーID、調整前後の量 |

### 期限関連イベント

| イベント名       | 英語                   | 発生タイミング | ペイロード                             |
| ---------------- | ---------------------- | -------------- | -------------------------------------- |
| 期限接近中       | IngredientExpiringSoon | 期限3日前      | 食材ID、ユーザーID、食材名、残日数     |
| 期限切れ発生     | IngredientExpired      | 期限切れ時     | 食材ID、ユーザーID、食材名、期限日     |
| 期限情報更新済み | ExpiryInfoUpdated      | 期限更新時     | 食材ID、ユーザーID、変更前後の期限情報 |

## 状態遷移

### 食材ライフサイクル

```
新規 → アクティブ → 期限接近 → 期限切れ → 廃棄
         ↓
      在庫切れ → 補充済み
```

### 在庫状態

| 現在の状態 | アクション | 次の状態          |
| ---------- | ---------- | ----------------- |
| 在庫あり   | 消費       | 在庫あり/在庫切れ |
| 在庫あり   | 補充       | 在庫あり          |
| 在庫切れ   | 補充       | 在庫あり          |
| 在庫切れ   | 削除       | 削除済み          |

## ドメイン固有の計算

### 消費速度

| 用語         | 計算式                | 用途             |
| ------------ | --------------------- | ---------------- |
| 日次消費量   | 総消費量 ÷ 経過日数   | 消費ペース把握   |
| 週次消費量   | 日次消費量 × 7        | 買い物計画       |
| 在庫持続日数 | 現在庫量 ÷ 日次消費量 | 次回購入時期予測 |

### 期限スコア

| スコア | 計算基準        | 表示 |
| ------ | --------------- | ---- |
| 100-80 | 期限まで8日以上 | 🟢   |
| 79-50  | 期限まで4-7日   | 🔵   |
| 49-20  | 期限まで2-3日   | 🟡   |
| 19-0   | 期限まで1日以内 | 🔴   |

## エラーメッセージ用語

### 在庫関連

| エラー種別     | メッセージ                         | 原因                   |
| -------------- | ---------------------------------- | ---------------------- |
| 在庫不足エラー | 「在庫が不足しています」           | 消費量 > 在庫量        |
| 重複エラー     | 「同じ食材が既に登録されています」 | 名前・期限・場所が一致 |
| 削除制限エラー | 「使用中のため削除できません」     | 他機能で参照中         |

## UI表示用語

### 状態表示

| 状態     | 表示テキスト     | アイコン/色 |
| -------- | ---------------- | ----------- |
| 新規登録 | 「NEW」          | 🆕 / 緑     |
| 期限間近 | 「まもなく期限」 | ⚠️ / 黄     |
| 期限切れ | 「期限切れ」     | ❌ / 赤     |
| 在庫切れ | 「在庫なし」     | 📦 / 灰     |

### アクションラベル

| 機能 | ボタンテキスト | 説明文                             |
| ---- | -------------- | ---------------------------------- |
| 登録 | 「食材を追加」 | 「新しい食材を登録します」         |
| 消費 | 「使用する」   | 「食材を消費して在庫を減らします」 |
| 補充 | 「買い足す」   | 「同じ食材を追加購入します」       |
| 廃棄 | 「廃棄する」   | 「食材を廃棄して履歴に残します」   |

## 通知メッセージ

### 期限通知

| タイミング | メッセージテンプレート                        |
| ---------- | --------------------------------------------- |
| 7日前      | 「{食材名}の賞味期限まであと1週間です」       |
| 3日前      | 「{食材名}がまもなく期限切れです（あと3日）」 |
| 1日前      | 「【要注意】{食材名}の期限は明日です」        |
| 当日       | 「【緊急】{食材名}が本日期限切れです」        |

### 在庫通知

| 状況       | メッセージテンプレート                   |
| ---------- | ---------------------------------------- |
| 在庫不足   | 「{食材名}の在庫が少なくなっています」   |
| 在庫切れ   | 「{食材名}の在庫がなくなりました」       |
| 長期未使用 | 「{食材名}を{日数}日間使用していません」 |

## 日本語・英語対応表

### エンティティ・値オブジェクト

| 日本語       | 英語実装名      | 型             | 備考                         |
| ------------ | --------------- | -------------- | ---------------------------- |
| 食材         | Ingredient      | エンティティ   | 集約ルート                   |
| カテゴリー   | Category        | エンティティ   | マスタデータ                 |
| 単位         | Unit            | エンティティ   | マスタデータ                 |
| 食材ID       | IngredientId    | 値オブジェクト | 食材の一意識別子             |
| ユーザーID   | UserId          | 値オブジェクト | 認証コンテキストから提供     |
| 食材在庫情報 | IngredientStock | 値オブジェクト | 数量、単位、保存場所を含む   |
| 期限情報     | ExpiryInfo      | 値オブジェクト | 賞味期限・消費期限を一体管理 |

### 主要な属性

| 日本語       | 英語実装名      | 型     | 使用場所        |
| ------------ | --------------- | ------ | --------------- |
| 食材名       | name            | string | Ingredient      |
| カテゴリーID | categoryId      | string | Ingredient      |
| メモ         | memo            | string | Ingredient      |
| 賞味期限     | bestBeforeDate  | Date   | ExpiryInfo      |
| 消費期限     | useByDate       | Date   | ExpiryInfo      |
| 保存場所     | storageLocation | string | IngredientStock |
| 在庫量       | quantity        | number | IngredientStock |
| 閾値         | threshold       | number | IngredientStock |

### API レスポンスのステータス

| 日本語   | APIステータス値 | 説明            |
| -------- | --------------- | --------------- |
| 新鮮     | FRESH           | 期限まで8日以上 |
| 期限接近 | NEAR_EXPIRY     | 期限まで7日以内 |
| 期限間近 | EXPIRING_SOON   | 期限まで3日以内 |
| 期限切迫 | CRITICAL        | 期限まで1日以内 |
| 期限切れ | EXPIRED         | 期限切れ        |

## 更新履歴

| 日付       | 内容                                                                                                  | 作成者    |
| ---------- | ----------------------------------------------------------------------------------------------------- | --------- |
| 2025-06-24 | 初版                                                                                                  | @ktakabay |
| 2025-06-24 | ユーザー認証統合に伴う修正（UserId、IngredientStock、ExpiryInfo、ドメインイベント、日英対応表の追加） | Claude    |
| 2025-06-24 | IngredientStock内のQuantity値オブジェクトの記載を削除（ドメインモデルに合わせて修正）                 | Claude    |
