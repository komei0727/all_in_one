# 食材管理コンテキスト - ドメインモデル仕様

## 概要

このドキュメントでは、食材管理コンテキストのドメインモデルを定義します。
エンティティ、値オブジェクト、その責務とビジネスルールに焦点を当てています。

## エンティティ

### 食材（Ingredient）

食材管理の中核となるエンティティ。在庫管理の対象となる個々の食材を表現します。

#### 属性

| 属性            | 型              | 説明         | 制約                     |
| --------------- | --------------- | ------------ | ------------------------ |
| id              | IngredientId    | 一意識別子   | 必須、不変               |
| name            | IngredientName  | 食材名       | 必須、1-50文字           |
| categoryId      | CategoryId      | カテゴリーID | 必須、存在するカテゴリー |
| quantity        | Quantity        | 数量         | 必須、0以上              |
| storageLocation | StorageLocation | 保存場所     | 必須                     |
| expiryInfo      | ExpiryInfo      | 期限情報     | 任意                     |
| notes           | string          | 備考         | 任意、最大200文字        |
| createdAt       | Date            | 作成日時     | 必須、不変               |
| updatedAt       | Date            | 更新日時     | 必須                     |
| deletedAt       | Date            | 削除日時     | 論理削除用               |

#### ビジネスルール

- 同じ名前・期限・保存場所の組み合わせは重複不可
- 数量は0以上（0でも履歴として保持）
- ExpiryInfo内で賞味期限と消費期限の整合性を保証
- 削除は論理削除のみ（履歴保持のため）

#### 主要な振る舞い

- `consume(quantity)` - 在庫を消費する
- `replenish(quantity)` - 在庫を補充する
- `isExpired()` - 期限切れかどうか判定
- `isExpiringSoon(days)` - 期限が近いか判定
- `updateExpiry(expiryInfo)` - 期限を更新

### カテゴリー（Category）

食材を分類するためのマスタエンティティ。

#### 属性

| 属性         | 型           | 説明         | 制約                 |
| ------------ | ------------ | ------------ | -------------------- |
| id           | CategoryId   | 一意識別子   | 必須、不変           |
| name         | CategoryName | カテゴリー名 | 必須、一意、1-20文字 |
| description  | string       | 説明         | 任意、最大100文字    |
| displayOrder | number       | 表示順       | 必須、0以上          |

#### ビジネスルール

- カテゴリー名は一意
- 階層構造は持たない（フラット構造）
- 表示順序で並び替え可能

### 単位（Unit）

数量を表現するためのマスタエンティティ。

#### 属性

| 属性         | 型       | 説明       | 制約                              |
| ------------ | -------- | ---------- | --------------------------------- |
| id           | UnitId   | 一意識別子 | 必須、不変                        |
| name         | UnitName | 単位名     | 必須、一意                        |
| symbol       | string   | 記号       | 必須、一意（例: "個", "g", "ml"） |
| type         | UnitType | 種別       | 必須（COUNT, WEIGHT, VOLUME）     |
| displayOrder | number   | 表示順     | 必須、0以上                       |

#### ビジネスルール

- 同じタイプの単位間のみ変換可能
- 単位タイプは変更不可

## 値オブジェクト

### 主要な値オブジェクト一覧

| 値オブジェクト  | 責務               | 主な制約                     |
| --------------- | ------------------ | ---------------------------- |
| IngredientId    | 食材の一意識別     | 必須、不変                   |
| IngredientName  | 食材名の表現       | 1-50文字、空白除去           |
| Quantity        | 数量の表現         | 0以上、単位を含む            |
| ExpiryInfo      | 期限情報の表現     | 賞味期限・消費期限の一体管理 |
| StorageLocation | 保存場所の表現     | 冷蔵/冷凍/常温               |
| CategoryId      | カテゴリーの識別   | 必須、不変                   |
| CategoryName    | カテゴリー名の表現 | 1-20文字、一意               |
| UnitId          | 単位の識別         | 必須、不変                   |
| UnitName        | 単位名の表現       | 必須、一意                   |

### Quantity（数量）

数値と単位の組み合わせを表現する値オブジェクト。

#### ビジネスルール

- 数量は0以上
- 同じ単位同士のみ加減算可能
- 異なる単位間の変換は単位タイプが同じ場合のみ

#### 主要な振る舞い

- `add(other)` - 加算（同じ単位のみ）
- `subtract(other)` - 減算（同じ単位のみ）
- `isZero()` - ゼロ判定
- `isLessThan(other)` - 比較

### StorageLocation（保存場所）

食材の保存場所を表現する値オブジェクト。

#### 保存場所タイプ

- `REFRIGERATED` - 冷蔵
- `FROZEN` - 冷凍
- `ROOM_TEMP` - 常温

#### 付加情報

詳細な場所（例：「冷蔵庫の野菜室」）を任意で保持可能。

### ExpiryInfo（期限情報）

賞味期限と消費期限を一体として管理する値オブジェクト。

#### 属性

- `bestBeforeDate` - 賞味期限（任意）
- `useByDate` - 消費期限（任意）

#### ビジネスルール

- 消費期限は賞味期限以前でなければならない
- どちらか一方のみの設定も可能
- 両方nullの場合も許可（期限なし商品）

#### 主要な振る舞い

- `isExpired()` - 期限切れ判定（消費期限優先、なければ賞味期限で判定）
- `isExpiringSoon(days)` - 期限接近判定
- `getDaysUntilExpiry()` - 期限までの日数取得
- `getDisplayDate()` - 表示用の期限日付取得（消費期限優先）

## ドメインサービス

### 在庫チェックサービス（StockCheckService）

複数食材の在庫状況を一括でチェックする。

#### 主要な責務

- 複数食材の在庫充足チェック
- 在庫不足食材の特定
- カテゴリー別の在庫集計

### 期限管理サービス（ExpiryManagementService）

食材の期限に関する処理を行う。

#### 主要な責務

- 期限切れ食材の抽出
- 期限切れ間近食材の抽出（デフォルト7日）
- 期限によるソート

### カテゴリー分類サービス（CategoryClassificationService）

食材の分類に関する処理を行う。

#### 主要な責務

- 食材名からカテゴリー推定
- カテゴリー別グループ化
- カテゴリー統計の生成

## ファクトリ

### IngredientFactory

食材エンティティの生成を担当。

#### 責務

- 食材の新規作成
- ビジネスルールの検証
- IDの生成

## 仕様パターン

### 主要な仕様

| 仕様                      | 目的                       | 条件                   |
| ------------------------- | -------------------------- | ---------------------- |
| ExpiringSoonSpecification | 期限切れ間近の食材を特定   | 指定日数以内に期限切れ |
| LowStockSpecification     | 在庫不足の食材を特定       | 閾値以下の在庫量       |
| CategorySpecification     | 特定カテゴリーの食材を特定 | カテゴリーIDが一致     |

## 更新履歴

| 日付       | 内容 | 作成者     |
| ---------- | ---- | ---------- |
| 2025-06-24 | 初版 | @komei0727 |
