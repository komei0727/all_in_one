# パスワードリセット

## 1. 基本情報

- **画面ID**: SCREEN_AUTH_003
- **パス**: /auth/forgot-password
- **作成日**: 2025-06-24
- **更新日**: 2025-06-24
- **ステータス**: 設計中
- **担当者**: @claude

## 2. 画面概要

### 目的

パスワードを忘れたユーザーが、メールアドレスを使用してパスワードリセットを開始するための画面。登録済みメールアドレスにリセット用のリンクを送信する。

### ユーザーストーリー

As a パスワードを忘れたユーザー
I want to パスワードをリセットする
So that 再度ログインできるようになる

### 前提条件・制約

- **アクセス権限**: 未認証ユーザーのみ（ログイン済みの場合はホーム画面へリダイレクト）
- **事前条件**: メールアドレスが登録済みであること
- **画面の制約事項**:
  - セキュリティのため、メールアドレスの存在有無に関わらず同じメッセージを表示
  - リセットリンクの有効期限は1時間
  - 連続リクエストの制限（同一メールアドレスは5分に1回まで）

## 3. UI設計

### 画面構成

```
┌─────────────────────────────────────┐
│       🍳 食材管理アプリ              │
├─────────────────────────────────────┤
│                                     │
│     パスワードをお忘れですか？       │
│                                     │
│   登録時のメールアドレスを入力して   │
│   ください。パスワードリセット用の   │
│   リンクをお送りします。            │
│                                     │
│   ┌─────────────────────────┐      │
│   │ メールアドレス          │      │
│   └─────────────────────────┘      │
│                                     │
│   [  リセットリンクを送信  ]        │
│                                     │
│   ─────────────────────────────    │
│                                     │
│   ログイン画面に戻る                │
│                                     │
└─────────────────────────────────────┘
```

### コンポーネント構成

- **ヘッダー**: アプリロゴとタイトル
- **メイン**:
  - 説明文
  - メールアドレス入力フォーム
  - 送信ボタン
  - ログイン画面への戻りリンク
- **フッター**: なし（シンプルな認証画面のため）

### レスポンシブ対応

- **モバイル (< 768px)**: フォーム幅100%、パディング16px
- **タブレット (768px - 1024px)**: フォーム幅400px、中央配置
- **デスクトップ (> 1024px)**: フォーム幅400px、中央配置

## 4. 機能仕様

### アクション一覧

| アクション         | トリガー                       | 処理内容                      | 結果                                           |
| ------------------ | ------------------------------ | ----------------------------- | ---------------------------------------------- |
| リセットリンク送信 | 送信ボタンクリック             | パスワードリセットAPI呼び出し | 成功メッセージ表示（メール存在有無に関わらず） |
| ログイン画面へ戻る | 「ログイン画面に戻る」クリック | ログイン画面へ遷移            | /auth/login へ                                 |

### フォーム仕様

| フィールド | 型     | 必須 | バリデーション                          | 初期値 |
| ---------- | ------ | ---- | --------------------------------------- | ------ |
| email      | string | ○    | - 必須<br>- メール形式<br>- 最大254文字 | 空     |

### 画面遷移

- **前画面**: ログイン画面
- **次画面**:
  - 同一画面（送信完了メッセージ表示）
  - ログイン画面（戻るリンククリック時）
- **エラー時**: 同一画面でエラーメッセージ表示

## 5. API仕様

### 使用するAPI

#### 1. パスワードリセットリクエスト

- **エンドポイント**: `POST /api/v1/auth/password/reset-request`
- **目的**: パスワードリセット用のトークン生成とメール送信
- **呼び出しタイミング**: リセットリンクを送信ボタンクリック時

**リクエスト**

```typescript
interface ForgotPasswordRequest {
  email: string
}
```

**レスポンス**

```typescript
interface ForgotPasswordResponse {
  message: string // "パスワードリセット用のリンクを送信しました。メールをご確認ください。"
}
```

**エラーハンドリング**
| エラーコード | 処理 |
|------------|------|
| 400 | 「有効なメールアドレスを入力してください」を表示 |
| 429 | 「リクエストが多すぎます。しばらくしてから再度お試しください」を表示 |
| 500 | 「システムエラーが発生しました。しばらくしてから再度お試しください」を表示 |

**注意**: セキュリティのため、メールアドレスが登録されていない場合でも200 OKを返し、同じメッセージを表示する。

## 6. 状態管理

### クライアント状態

```typescript
interface ForgotPasswordFormState {
  email: string
  isSubmitting: boolean
  isSubmitted: boolean
  error: string | null
}
```

### サーバー状態（TanStack Query）

- **mutationKey**: `['auth', 'forgot-password']`
- **キャッシュ戦略**: なし（一度きりの操作）
- **再検証タイミング**: なし

### URL状態

- **クエリパラメータ**: なし

## 7. 実装ガイド

### 使用コンポーネント

- **shadcn/ui**:
  - Card, CardHeader, CardContent
  - Input
  - Button
  - Label
  - Alert（成功/エラーメッセージ）
- **カスタムコンポーネント**: なし

### ディレクトリ構成

```
src/
├── app/auth/forgot-password/
│   └── page.tsx
└── modules/auth/
    └── client/
        ├── components/
        │   └── ForgotPasswordForm.tsx
        └── hooks/
            └── useForgotPassword.ts
```

### 実装時の注意点

- 送信完了後は成功メッセージを表示し、フォームは非表示にする
- 連続送信を防ぐため、送信ボタンは処理中は無効化
- メールアドレスの存在確認は行わない（セキュリティ上の理由）
- 送信完了メッセージには「メールが届かない場合は迷惑メールフォルダをご確認ください」を含める
- リセットメールのテンプレートは別途作成が必要

### 送信されるメールの内容（参考）

```
件名: [食材管理アプリ] パスワードリセットのご案内

本文:
パスワードリセットのリクエストを受け付けました。

以下のリンクをクリックして、新しいパスワードを設定してください：
https://app.example.com/auth/reset-password?token=xxxxxxxxxxxx

このリンクは1時間有効です。

このメールに心当たりがない場合は、無視してください。
パスワードは変更されません。

--
食材管理アプリ サポート
```

### テスト観点

- [ ] **正常系**:
  - 有効なメールアドレスで送信成功
  - 成功メッセージの表示
  - ログイン画面への戻り
- [ ] **異常系**:
  - 無効なメールアドレス形式
  - 空のメールアドレス
  - レート制限エラー
- [ ] **エッジケース**:
  - ログイン済みユーザーのアクセス（ホームへリダイレクト）
  - 存在しないメールアドレス（同じ成功メッセージ表示）
  - 連続送信試行
  - ネットワークエラー時の処理
