# 新規登録

## 1. 基本情報

- **画面ID**: SCREEN_AUTH_002
- **パス**: /auth/register
- **作成日**: 2025-06-24
- **更新日**: 2025-06-24
- **ステータス**: 設計中
- **担当者**: @claude

## 2. 画面概要

### 目的

新規ユーザーがアカウントを作成し、システムの利用を開始するための画面。メールアドレスとパスワードによる登録を提供する。

### ユーザーストーリー

As a 新規ユーザー
I want to アカウントを作成する
So that 食材管理アプリを利用できる

### 前提条件・制約

- **アクセス権限**: 未認証ユーザーのみ（ログイン済みの場合はホーム画面へリダイレクト）
- **事前条件**: なし
- **画面の制約事項**:
  - パスワードは最低8文字、大文字・小文字・数字を含む
  - メールアドレスの重複チェック
  - 利用規約への同意が必須

## 3. UI設計

### 画面構成

```
┌─────────────────────────────────────┐
│       🍳 食材管理アプリ              │
├─────────────────────────────────────┤
│                                     │
│         新規登録                     │
│                                     │
│   ┌─────────────────────────┐      │
│   │ お名前                  │      │
│   └─────────────────────────┘      │
│                                     │
│   ┌─────────────────────────┐      │
│   │ メールアドレス          │      │
│   └─────────────────────────┘      │
│                                     │
│   ┌─────────────────────────┐      │
│   │ パスワード             │👁     │
│   └─────────────────────────┘      │
│   ・8文字以上                       │
│   ・大文字・小文字・数字を含む      │
│                                     │
│   ┌─────────────────────────┐      │
│   │ パスワード（確認）      │👁     │
│   └─────────────────────────┘      │
│                                     │
│   □ 利用規約に同意します            │
│                                     │
│   [    登録する    ]               │
│                                     │
│   ─────────── または ───────────    │
│                                     │
│   既にアカウントをお持ちの方        │
│   [  ログイン  ]                   │
│                                     │
└─────────────────────────────────────┘
```

### コンポーネント構成

- **ヘッダー**: アプリロゴとタイトル
- **メイン**:
  - 登録フォーム（名前、メールアドレス、パスワード、パスワード確認）
  - パスワード要件の表示
  - 利用規約同意チェックボックス
  - 登録ボタン
  - ログイン画面への導線
- **フッター**: なし（シンプルな認証画面のため）

### レスポンシブ対応

- **モバイル (< 768px)**: フォーム幅100%、パディング16px
- **タブレット (768px - 1024px)**: フォーム幅400px、中央配置
- **デスクトップ (> 1024px)**: フォーム幅400px、中央配置

## 4. 機能仕様

### アクション一覧

| アクション             | トリガー                   | 処理内容                               | 結果                                                                         |
| ---------------------- | -------------------------- | -------------------------------------- | ---------------------------------------------------------------------------- |
| 登録                   | 登録するボタンクリック     | 登録API呼び出し                        | 成功：登録完了メッセージ表示後、ログイン画面へ<br>失敗：エラーメッセージ表示 |
| パスワード表示切替     | 目アイコンクリック         | パスワードの表示/非表示切替            | 入力内容が見える/隠れる                                                      |
| パスワード強度チェック | パスワード入力             | リアルタイムで要件を満たしているか表示 | 要件を満たした項目に✓表示                                                    |
| ログイン画面へ         | 「ログイン」ボタンクリック | ログイン画面へ遷移                     | /auth/login へ                                                               |
| 利用規約表示           | 「利用規約」リンククリック | 利用規約モーダル表示                   | モーダルで規約内容表示                                                       |

### フォーム仕様

| フィールド      | 型      | 必須 | バリデーション                                                   | 初期値 |
| --------------- | ------- | ---- | ---------------------------------------------------------------- | ------ |
| displayName     | string  | ○    | - 必須<br>- 1-50文字<br>- 特殊文字制限                           | 空     |
| email           | string  | ○    | - 必須<br>- メール形式<br>- 最大254文字<br>- 重複チェック        | 空     |
| password        | string  | ○    | - 必須<br>- 8文字以上128文字以下<br>- 大文字・小文字・数字を含む | 空     |
| passwordConfirm | string  | ○    | - 必須<br>- passwordと一致                                       | 空     |
| agreeToTerms    | boolean | ○    | - 必須（true）                                                   | false  |

### 画面遷移

- **前画面**:
  - ログイン画面
  - ランディングページ（将来実装）
- **次画面**:
  - ログイン画面（登録成功時、「登録が完了しました」のメッセージ付き）
- **エラー時**: 同一画面でエラーメッセージ表示

## 5. API仕様

### 使用するAPI

#### 1. ユーザー登録

- **エンドポイント**: `POST /api/v1/auth/register`
- **目的**: 新規ユーザーアカウントの作成
- **呼び出しタイミング**: 登録するボタンクリック時

**リクエスト**

```typescript
interface RegisterRequest {
  displayName: string
  email: string
  password: string
}
```

**レスポンス**

```typescript
interface RegisterResponse {
  user: {
    id: string
    email: string
    displayName: string
    emailVerified: false
  }
  message: string // "登録が完了しました。ログインしてください。"
}
```

**エラーハンドリング**
| エラーコード | 処理 |
|------------|------|
| 400 | 各フィールドのバリデーションエラーを表示 |
| 409 | 「このメールアドレスは既に登録されています」を表示 |
| 500 | 「システムエラーが発生しました。しばらくしてから再度お試しください」を表示 |

#### 2. メールアドレス重複チェック（オプション）

- **エンドポイント**: `GET /api/v1/auth/check-email?email={email}`
- **注意**: このAPIは現在API設計書に未定義。実装時に追加予定
- **目的**: リアルタイムでメールアドレスの重複をチェック
- **呼び出しタイミング**: メールアドレス入力フィールドのフォーカスアウト時

**レスポンス**

```typescript
interface CheckEmailResponse {
  available: boolean
}
```

## 6. 状態管理

### クライアント状態

```typescript
interface RegisterFormState {
  displayName: string
  email: string
  password: string
  passwordConfirm: string
  agreeToTerms: boolean
  showPassword: boolean
  showPasswordConfirm: boolean
  isSubmitting: boolean
  errors: {
    displayName?: string
    email?: string
    password?: string
    passwordConfirm?: string
    agreeToTerms?: string
  }
  passwordStrength: {
    hasMinLength: boolean
    hasUpperCase: boolean
    hasLowerCase: boolean
    hasNumber: boolean
  }
}
```

### サーバー状態（TanStack Query）

- **mutationKey**: `['auth', 'register']`
- **queryKey**: `['auth', 'check-email', email]` （重複チェック用）
- **キャッシュ戦略**: 重複チェック結果は5分間キャッシュ
- **再検証タイミング**: なし

### URL状態

- **クエリパラメータ**: なし

## 7. 実装ガイド

### 使用コンポーネント

- **shadcn/ui**:
  - Card, CardHeader, CardContent
  - Input
  - Button
  - Checkbox
  - Label
  - Alert
  - Dialog（利用規約モーダル）
- **カスタムコンポーネント**:
  - PasswordInput（パスワード表示切替機能付き）
  - PasswordStrengthIndicator（パスワード強度表示）

### ディレクトリ構成

```
src/
├── app/auth/register/
│   └── page.tsx
└── modules/auth/
    ├── client/
    │   ├── components/
    │   │   ├── RegisterForm.tsx
    │   │   └── PasswordStrengthIndicator.tsx
    │   └── hooks/
    │       ├── useRegister.ts
    │       └── useCheckEmail.ts
    └── shared/
        └── utils/
            └── password-validation.ts
```

### 実装時の注意点

- パスワードはクライアント側でもバリデーション（UX向上のため）
- メールアドレスの重複チェックはデバウンス処理（過剰なAPI呼び出し防止）
- 登録成功後は自動ログインせず、ログイン画面へ誘導（セキュリティのため）
- パスワード強度のリアルタイム表示でユーザビリティ向上
- 利用規約は別途作成が必要

### テスト観点

- [ ] **正常系**:
  - 全項目を正しく入力して登録成功
  - 登録後のログイン画面遷移
  - パスワード強度表示の動作
- [ ] **異常系**:
  - 必須項目未入力
  - 無効なメールアドレス形式
  - 弱いパスワード
  - パスワード不一致
  - メールアドレス重複
  - 利用規約未同意
- [ ] **エッジケース**:
  - ログイン済みユーザーのアクセス（ホームへリダイレクト）
  - 同一メールアドレスでの連続登録試行
  - ネットワークエラー時の処理
  - 極端に長い/短い入力値
