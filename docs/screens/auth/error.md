# 認証エラー画面

## 1. 基本情報

- **画面ID**: SCREEN_AUTH_006
- **パス**: /auth/error
- **作成日**: 2025-06-24
- **更新日**: 2025-06-24
- **ステータス**: 設計中
- **担当者**: @claude

## 2. 画面概要

### 目的

NextAuth認証プロセス中にエラーが発生した場合に表示される画面。エラーの種類に応じた適切なメッセージと次のアクションを提示する。

### ユーザーストーリー

As a 認証エラーに遭遇したユーザー
I want to エラーの内容と対処法を理解する
So that 適切な次のアクションを取ることができる

### 前提条件・制約

- **アクセス権限**: 未認証ユーザー（認証エラー発生時）
- **事前条件**: NextAuthの認証プロセス中にエラーが発生
- **画面の制約事項**:
  - NextAuthが自動的にこの画面へリダイレクト
  - エラーの詳細はクエリパラメータで受け取る

## 3. UI設計

### 画面構成

```
┌─────────────────────────────────────┐
│       🍳 食材管理アプリ              │
├─────────────────────────────────────┤
│                                     │
│         ⚠️ エラーが発生しました      │
│                                     │
│   [エラーメッセージ]                │
│                                     │
│   申し訳ございません。認証処理中に   │
│   問題が発生しました。              │
│                                     │
│   ────────────────────────────      │
│                                     │
│   対処法：                          │
│   • しばらく待ってから再度お試し    │
│     ください                        │
│   • 問題が続く場合はサポートへ      │
│     お問い合わせください            │
│                                     │
│   [ ログイン画面に戻る ]            │
│   [    ホームへ戻る    ]            │
│                                     │
└─────────────────────────────────────┘
```

### エラータイプ別の表示

#### 1. マジックリンク期限切れ
```
⚠️ リンクの有効期限が切れています

このリンクは15分間のみ有効です。
もう一度ログイン画面からメールアドレスを
入力してください。
```

#### 2. 無効なマジックリンク
```
⚠️ 無効なリンクです

このリンクは無効または既に使用済みです。
ログイン画面から新しいリンクを
リクエストしてください。
```

#### 3. メール送信エラー
```
⚠️ メールの送信に失敗しました

メールの送信中に問題が発生しました。
しばらく待ってから再度お試しください。
```

#### 4. アクセス拒否
```
⚠️ アクセスが拒否されました

このアカウントへのアクセスは
制限されています。
```

#### 5. その他のエラー
```
⚠️ エラーが発生しました

認証処理中に問題が発生しました。
しばらく待ってから再度お試しください。
```

### コンポーネント構成

- **ヘッダー**: アプリロゴとタイトル
- **メイン**:
  - エラーアイコン
  - エラータイトル
  - エラーメッセージ（エラータイプに応じて変更）
  - 対処法の説明
  - アクションボタン（ログイン画面へ、ホームへ）
- **フッター**: なし（シンプルな認証画面のため）

### レスポンシブ対応

- **モバイル (< 768px)**: コンテンツ幅100%、パディング16px
- **タブレット (768px - 1024px)**: コンテンツ幅400px、中央配置
- **デスクトップ (> 1024px)**: コンテンツ幅400px、中央配置

## 4. 機能仕様

### アクション一覧

| アクション       | トリガー                       | 処理内容           | 結果           |
| ---------------- | ------------------------------ | ------------------ | -------------- |
| ログイン画面戻る | 「ログイン画面に戻る」クリック | ログイン画面へ遷移 | /auth/login へ |
| ホームへ戻る     | 「ホームへ戻る」クリック       | ホーム画面へ遷移   | / へ           |

### フォーム仕様

なし（表示のみの画面）

### 画面遷移

- **前画面**: 
  - マジックリンク（期限切れ・無効）
  - ログイン画面（エラー発生時）
  - その他の認証プロセス
- **次画面**:
  - ログイン画面
  - ホーム画面
- **エラー時**: なし（エラー表示画面のため）

## 5. API仕様

### 使用するAPI

なし（静的なエラー表示画面）

NextAuthのエラータイプはクエリパラメータで受け取る：
- `?error=Configuration` - 設定エラー
- `?error=AccessDenied` - アクセス拒否
- `?error=Verification` - 検証エラー（期限切れ等）
- `?error=Default` - その他のエラー

## 6. 状態管理

### クライアント状態

```typescript
interface ErrorPageState {
  errorType: string | null // URLパラメータから取得
}
```

### サーバー状態（NextAuth）

なし（静的画面）

### URL状態

- **クエリパラメータ**:
  - `error`: エラータイプ（NextAuthから自動的に付与）
  - 例: `/auth/error?error=Verification`

## 7. 実装ガイド

### 使用コンポーネント

- **shadcn/ui**:
  - Card, CardHeader, CardContent
  - Button
  - Alert（エラー表示用）
- **Next.js**:
  - useSearchParams（クエリパラメータ取得）

### ディレクトリ構成

```
src/
└── app/auth/error/
    └── page.tsx
```

### 実装時の注意点

- NextAuthがデフォルトでこのパスにリダイレクトする
- エラータイプに応じて適切なメッセージを表示
- ユーザーフレンドリーな表現を使用（技術的すぎない）
- 必ず次のアクションを明示する
- セキュリティ上、詳細なエラー情報は表示しない

### エラーメッセージマッピング

```typescript
const errorMessages = {
  Configuration: {
    title: 'システム設定エラー',
    message: '認証システムの設定に問題があります。管理者にお問い合わせください。'
  },
  AccessDenied: {
    title: 'アクセスが拒否されました',
    message: 'このアカウントへのアクセスは制限されています。'
  },
  Verification: {
    title: 'リンクの有効期限切れ',
    message: 'このリンクは15分間のみ有効です。もう一度ログイン画面からメールアドレスを入力してください。'
  },
  Default: {
    title: 'エラーが発生しました',
    message: '認証処理中に問題が発生しました。しばらく待ってから再度お試しください。'
  }
}
```

### テスト観点

- [ ] **正常系**:
  - 各エラータイプで適切なメッセージが表示される
  - ログイン画面への遷移が機能する
  - ホーム画面への遷移が機能する
- [ ] **異常系**:
  - エラーパラメータなしでのアクセス（デフォルトメッセージ表示）
  - 不明なエラータイプ（デフォルトメッセージ表示）
- [ ] **エッジケース**:
  - ログイン済みユーザーのアクセス（ホームへリダイレクト）
  - 複数のエラーパラメータ