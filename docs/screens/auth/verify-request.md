# メール確認画面

## 1. 基本情報

- **画面ID**: SCREEN_AUTH_005
- **パス**: /auth/verify-request
- **作成日**: 2025-06-24
- **更新日**: 2025-06-24
- **ステータス**: 設計中
- **担当者**: @claude

## 2. 画面概要

### 目的

NextAuthのマジックリンク認証でメール送信後に表示される確認画面。ユーザーにメールの確認を促し、マジックリンクのクリックを待つ。

### ユーザーストーリー

As a ログインしようとしているユーザー
I want to メールが送信されたことを確認する
So that 次のステップ（メール確認）を理解できる

### 前提条件・制約

- **アクセス権限**: 未認証ユーザー（マジックリンク送信後のリダイレクト先）
- **事前条件**: ログイン画面でメールアドレスを送信済み
- **画面の制約事項**:
  - NextAuthが自動的にこの画面へリダイレクト
  - メールアドレスはセキュリティのため非表示または一部マスク

## 3. UI設計

### 画面構成

```
┌─────────────────────────────────────┐
│       🍳 食材管理アプリ              │
├─────────────────────────────────────┤
│                                     │
│         📧 メールを確認してください   │
│                                     │
│   ログイン用のリンクをメールで送信   │
│   しました。                        │
│                                     │
│   メール内のリンクをクリックして、   │
│   ログインを完了してください。      │
│                                     │
│   ────────────────────────────      │
│                                     │
│   メールが届かない場合：            │
│   • 迷惑メールフォルダを確認        │
│   • 正しいメールアドレスか確認      │
│                                     │
│   [ ログイン画面に戻る ]            │
│                                     │
└─────────────────────────────────────┘
```

### コンポーネント構成

- **ヘッダー**: アプリロゴとタイトル
- **メイン**:
  - 確認アイコン（メール）
  - 確認メッセージ
  - 手順説明
  - トラブルシューティング情報
  - ログイン画面への戻りボタン
- **フッター**: なし（シンプルな認証画面のため）

### レスポンシブ対応

- **モバイル (< 768px)**: コンテンツ幅100%、パディング16px
- **タブレット (768px - 1024px)**: コンテンツ幅400px、中央配置
- **デスクトップ (> 1024px)**: コンテンツ幅400px、中央配置

## 4. 機能仕様

### アクション一覧

| アクション       | トリガー                       | 処理内容           | 結果               |
| ---------------- | ------------------------------ | ------------------ | ------------------ |
| ログイン画面戻る | 「ログイン画面に戻る」クリック | ログイン画面へ遷移 | /auth/login へ     |
| 自動ポーリング   | 画面表示中（オプション）       | セッション状態確認 | ログイン成功時遷移 |

### フォーム仕様

なし（表示のみの画面）

### 画面遷移

- **前画面**: ログイン画面（マジックリンク送信後）
- **次画面**:
  - ホーム画面（マジックリンククリック後、自動的に）
  - ログイン画面（戻るボタンクリック時）
- **エラー時**: なし（静的な確認画面）

## 5. API仕様

### 使用するAPI

#### 1. セッション確認（オプション）

- **エンドポイント**: NextAuth getSession API
- **目的**: ユーザーがマジックリンクをクリックしたかの確認
- **呼び出しタイミング**: 定期的なポーリング（5秒ごと）※実装は任意

**実装例**

```typescript
import { useSession } from 'next-auth/react'

// セッション状態を監視
const { data: session, status } = useSession()

// ログイン成功時に自動遷移
useEffect(() => {
  if (status === 'authenticated') {
    router.push('/')
  }
}, [status])
```

## 6. 状態管理

### クライアント状態

```typescript
interface VerifyRequestState {
  // 特別な状態管理は不要（静的画面）
  isPolling?: boolean // ポーリング実装時のみ
}
```

### サーバー状態（NextAuth）

- useSession()フックでセッション状態を監視（オプション）
- 自動ポーリングによるログイン検知（オプション）

### URL状態

- **クエリパラメータ**: なし

## 7. 実装ガイド

### 使用コンポーネント

- **shadcn/ui**:
  - Card, CardHeader, CardContent
  - Button
  - Alert（情報表示用）
- **NextAuth**:
  - useSession フック（オプション）

### ディレクトリ構成

```
src/
└── app/auth/verify-request/
    └── page.tsx
```

### 実装時の注意点

- NextAuthがデフォルトでこのパスにリダイレクトする
- シンプルで分かりやすいメッセージを表示
- メールアドレスは表示しない（セキュリティ上の理由）
- 自動ポーリングは実装してもしなくても良い（UX向上のため）
- マジックリンクの有効期限（15分）については言及しても良い

### テスト観点

- [ ] **正常系**:
  - 適切なメッセージが表示される
  - ログイン画面への戻りが機能する
  - ポーリング実装時：ログイン成功時の自動遷移
- [ ] **異常系**:
  - 直接アクセス時の表示（問題なし）
- [ ] **エッジケース**:
  - ログイン済みユーザーのアクセス（ホームへリダイレクト）
  - 長時間放置後の動作
